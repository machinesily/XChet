{"version":3,"sources":["uni-app:///main.js","webpack:///C:/Users/86184/Desktop/毕业设计/Xchat/pages/chatRoom/chatRoom.vue?203d","webpack:///C:/Users/86184/Desktop/毕业设计/Xchat/pages/chatRoom/chatRoom.vue?c625","webpack:///C:/Users/86184/Desktop/毕业设计/Xchat/pages/chatRoom/chatRoom.vue?716f","webpack:///C:/Users/86184/Desktop/毕业设计/Xchat/pages/chatRoom/chatRoom.vue?6b83","uni-app:///pages/chatRoom/chatRoom.vue","webpack:///C:/Users/86184/Desktop/毕业设计/Xchat/pages/chatRoom/chatRoom.vue?e355","webpack:///C:/Users/86184/Desktop/毕业设计/Xchat/pages/chatRoom/chatRoom.vue?aba6"],"names":["createPage","Page"],"mappings":";;;;;;;;;;kDAAA;AACA;AACA,qG;AACAA,UAAU,CAACC,iBAAD,CAAV,C;;;;;;;;;;;;;ACHA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAqH;AACrH;AAC4D;AACL;AACc;;;AAGrE;AAC0K;AAC1K,gBAAgB,mLAAU;AAC1B,EAAE,8EAAM;AACR,EAAE,mFAAM;AACR,EAAE,4FAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,uFAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACvBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA,aAAa,8LAEN;AACP;AACA;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACjCA;AAAA;AAAA;AAAA;AAA2nB,CAAgB,gpBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACwB/oB;AACA;AACA,cADA;AAEA,sBAFA,EADA;;AAKA,QALA,kBAKA,CALA,EAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAdA;AAeA;AACA;AACA;AACA,KAFA,EAEA,GAFA;AAGA,GAnBA;AAoBA,SApBA,qBAoBA;AACA;AACA,uBADA;AAEA,MAFA,CAEA,IAFA;AAGA,UAHA,CAGA,OAHA;AAIA;AACA,UADA;AAEA;AACA,gBADA,EAFA;;AAKA;AACA;AACA;AACA,KARA;;AAUA,QAVA;;;;;;;;;;;;;;AAwBA,GAjDA;AAkDA,aAlDA,yBAkDA;AACA,mCADA,CACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAFA,MAEA;AACA;AACA;AACA;AACA,mBADA;AAEA,mBAFA;AAGA,uBAHA;;AAKA;AACA;AACA,GApEA;AAqEA,MArEA,kBAqEA;AACA;AACA,aADA;AAEA,gBAFA;AAGA,eAHA;AAIA,gBAJA;AAKA,aALA;AAMA,eANA,EAMA;AACA,iBAPA,EAOA;AACA,cARA,EAQA;AACA,cATA,EASA;AACA,cAVA,EAUA;AACA,sBAXA,EAWA;AACA,mBAZA,EAYA;AACA,gBAbA;AAcA,kBAdA;AAeA,sBAfA;;AAiBA,GAvFA;AAwFA;AACA;AACA,eAFA,yBAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SALA,MAKA;AACA;AACA;AACA,iCADA;;AAGA;AACA,OAbA,CAaA;AACA;AACA;AACA,KAnBA;;AAqBA,QArBA,kBAqBA;AACA;AACA;AACA;AACA,6BADA,GADA;;AAIA,wBAJA;AAKA,KA5BA;;AA8BA;AACA,UA/BA,oBA+BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uBADA;AAEA,uBAFA;AAGA,+BAHA;AAIA,iCAJA;AAKA,2BALA;;AAOA,OAVA,MAUA;AACA;AACA;AACA;AACA,uBADA;AAEA,+BAFA;AAGA,iCAHA;AAIA,2BAJA;;AAMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uBAfA;AAgBA,qBAhBA,aAgBA;AACA;AACA;AACA,eAFA,MAEA;AACA;AACA;AACA,aAtBA;AAuBA;AACA;AACA;AACA;AACA,eAFA,EAEA,GAFA;AAGA,aAJA;AAKA,WANA,MAMA;AACA;AACA;AACA,aAFA;AAGA;AACA;AACA;AACA;AACA;AACA,SAFA,MAEA;AACA;AACA;AACA;AACA;AACA;AACA,OA7CA;AA8CA,KArGA;;AAuGA;AACA,iBAxGA,2BAwGA;AACA;AACA;AACA;AACA;AACA;AACA,WAJA;;AAMA;AACA,KAjHA;;AAmHA;AACA,WApHA,mBAoHA,CApHA,EAoHA;AACA;AACA;AACA;AACA,KAxHA;;AA0HA;AACA,YA3HA,oBA2HA,CA3HA,EA2HA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,+CADA;AAEA,6BAFA;AAGA,sBAHA;AAIA;AACA,oBADA;AAEA,sFAFA,EAJA;;AAQA;AACA;AACA,yCADA;AAEA,qBAFA;;AAIA;AACA,WAdA;AAeA;AACA;AACA,WAjBA;;AAmBA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,+CADA;AAEA,oCAFA;AAGA,sBAHA;AAIA;AACA,qBADA;AAEA,iDAFA,EAJA;;AAQA;AACA;AACA,wCADA;AAEA,kCAFA;;AAIA;AACA;AACA,gCADA;AAEA,0BAFA;;AAIA;AACA,WAnBA;;AAqBA;AACA,KAtLA;;AAwLA;AACA,YAzLA,oBAyLA,CAzLA,EAyLA;AACA;;AAEA;AACA;AACA;AACA;AACA,iEAPA,CAOA;AACA;AACA,aADA;AAEA,cAFA;AAGA,cAHA,CAGA,CAHA,EAGA,CAHA;AAIA;AACA,KAtMA;;AAwMA;AACA,cAzMA,sBAyMA,CAzMA,EAyMA,EAzMA,EAyMA,MAzMA,EAyMA,GAzMA,EAyMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kBADA;AAEA,sBAFA;AAGA,0BAHA;AAIA,oBAJA;AAKA,wBALA;AAMA,gBANA;;AAQA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAFA,MAEA;AACA;AACA;AACA;AACA;AACA,KAvOA;;AAyOA;AACA,aA1OA,uBA0OA;AACA;AACA;AACA;AACA;AACA;AACA,WAFA,MAEA;AACA;AACA;AACA;AACA,WAJA,MAIA;AACA;AACA;;AAEA;AACA,uBADA;AAEA,kCAFA;AAGA,gCAHA;AAIA,0BAJA;AAKA,4BALA;AAMA,oBANA;;AAQA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAFA,MAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAFA;AAGA;AACA,OA3CA;AA4CA,KAvRA;;AAyRA;AACA,kBA1RA,4BA0RA;AACA;AACA;AACA;AACA;AACA,SAFA,MAEA;AACA;AACA;AACA,SAHA,MAGA;;;;AAIA;;AAEA;AACA,wBADA;AAEA,yBAFA;AAGA,8BAHA;AAIA,wBAJA;AAKA,0BALA;AAMA,kBANA;;AAQA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAFA,MAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAFA;AAGA,OA1CA;AA2CA,KAtUA;;AAwUA;AACA,cAzUA,sBAyUA,CAzUA,EAyUA;AACA;AACA;AACA;AACA,OAHA,MAGA;AACA;AACA;AACA;AACA,KAjVA;;AAmVA;AACA,WApVA,mBAoVA,CApVA,EAoVA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAHA;AAIA,KA9VA;;AAgWA;AACA,mBAjWA,6BAiWA;AACA;AACA;AACA,YADA,CACA,OADA;AAEA,wBAFA,CAEA;AACA;AACA;AACA,OALA;AAMA,UANA;AAOA,KA1WA;;AA4WA;AACA,eA7WA,yBA6WA;AACA;AACA;AACA;AACA;AACA;AACA,qDADA;;AAGA,KArXA;;AAuXA,cAvXA,sBAuXA,GAvXA,EAuXA;AACA;AACA;AACA;AACA,OAFA,EAEA,GAFA;AAGA;AACA,6CADA;;AAGA,KA/XA,EAxFA,E;;;;;;;;;;;;;ACxBA;AAAA;AAAA;AAAA;AAAipC,CAAgB,knCAAG,EAAC,C;;;;;;;;;;;ACArqC;AACA,OAAO,KAAU,EAAE,kBAKd","file":"pages/chatRoom/chatRoom.js","sourcesContent":["import 'uni-pages';\nimport Vue from 'vue'\nimport Page from './pages/chatRoom/chatRoom.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./chatRoom.vue?vue&type=template&id=35e753e6&\"\nvar renderjs\nimport script from \"./chatRoom.vue?vue&type=script&lang=js&\"\nexport * from \"./chatRoom.vue?vue&type=script&lang=js&\"\nimport style0 from \"./chatRoom.vue?vue&type=style&index=0&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!D:\\\\App\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\runtime\\\\componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/chatRoom/chatRoom.vue\"\nexport default component.exports","export * from \"-!D:\\\\App\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\templateLoader.js??vue-loader-options!D:\\\\App\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--16-0!D:\\\\App\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\template.js!D:\\\\App\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-uni-app-loader\\\\page-meta.js!D:\\\\App\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\App\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./chatRoom.vue?vue&type=template&id=35e753e6&\"","var components\ntry {\n  components = {\n    chatRoom: function() {\n      return import(\n        /* webpackChunkName: \"components/chat-room/chat-room\" */ \"@/components/chat-room/chat-room.vue\"\n      )\n    }\n  }\n} catch (e) {\n  if (\n    e.message.indexOf(\"Cannot find module\") !== -1 &&\n    e.message.indexOf(\".vue\") !== -1\n  ) {\n    console.error(e.message)\n    console.error(\"1. 排查组件名称拼写是否正确\")\n    console.error(\n      \"2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom\"\n    )\n    console.error(\n      \"3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件\"\n    )\n  } else {\n    throw e\n  }\n}\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!D:\\\\App\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!D:\\\\App\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--12-1!D:\\\\App\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!D:\\\\App\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\App\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./chatRoom.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!D:\\\\App\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!D:\\\\App\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--12-1!D:\\\\App\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!D:\\\\App\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\App\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./chatRoom.vue?vue&type=script&lang=js&\"","<template>\n\t<view class=\"wrapper\">\n\t\t<top-bar class=\"top-bar\">\n\t\t\t<image src=\"../../static/images/common/back.png\" class=\"back\" slot=\"left\" @click=\"back\"></image>\n\t\t\t<view class=\"title\" slot=\"center\">{{ fname }}</view>\n\t\t\t<image :src=\"fimgurl\" slot=\"right\" class=\"more\" v-show=\"type == 1\" @tap=\"goGroupHome\" />\n\t\t</top-bar>\n\t\t<scroll-view\n\t\t\tclass=\"chat-wrapper\"\n\t\t\t:style=\"{ paddingBottom: sendHeight + 'px' }\"\n\t\t\tscroll-y=\"true\"\n\t\t\tscroll-with-animation=\"true\"\n\t\t\t:scroll-into-view=\"scrollToView\"\n\t\t\t@scrolltoupper=\"scrolltoupper\"\n\t\t>\n\t\t\t<chat-room :msgs=\"msgs\" :uid=\"uid\" :imgs=\"imgs\" :scrollToView=\"scrollToView\" @goUserHome=\"goUserHome\" ref=\"chatRoom\" />\n\t\t</scroll-view>\n\t\t<send @send=\"sendMsg\" @heights=\"heights\" ref=\"send\"/>\n\t</view>\n</template>\n\n<script>\nimport send from '../../components/chatSend/chet-send.vue';\nimport chatRoom from '../../components/chat-room/chat-room.vue';\nexport default {\n\tcomponents: {\n\t\tsend,\n\t\tchatRoom\n\t},\n\tonLoad(e) {\n\t\tthis.fid = e.id;\n\t\tthis.fname = e.name;\n\t\tthis.type = e.type;\n\t\tthis.fimgurl = e.imgurl;\n\t\tthis.getStorages();\n\t\tthis.getMsg();\n\t\tthis.scoketMsg();\n\t\tthis.scoketGroupMsg()\n\t},\n\tonPullDownRefresh: () => {\n\t\tsetTimeout(function() {\n\t\t\tuni.stopPullDownRefresh();\n\t\t}, 300);\n\t},\n\tmounted() {\n\t\tlet view = uni\n\t\t\t.createSelectorQuery()\n\t\t\t.in(this)\n\t\t\t.select('.send');\n\t\tview\n\t\t\t.fields(\n\t\t\t\t{\n\t\t\t\t\tsize: true\n\t\t\t\t},\n\t\t\t\tdata => {\n\t\t\t\t\tconsole.log(data.height);\n\t\t\t\t\tthis.sendHeight = data.height - 129;\n\t\t\t\t}\n\t\t\t)\n\t\t\t.exec();\n\t\t// #ifdef APP-PLUS\n\t\tview\n\t\t\t.fields(\n\t\t\t\t{\n\t\t\t\t\tsize: true\n\t\t\t\t},\n\t\t\t\tdata => {\n\t\t\t\t\tconsole.log(data.height);\n\t\t\t\t\tthis.sendHeight = data.height;\n\t\t\t\t}\n\t\t\t)\n\t\t\t.exec();\n\t\t//#endif\n\t},\n\tonBackPress() {\n\t\tthis.$refs.chatRoom.palyStop(); //暂停语音播放\n\t\tuni.$emit('refresh',{msg:'页面更新'})\n\t\t//把后端的消息表状态改为已读\n\t\tlet pages = getCurrentPages();\n\t\t\tlet url = ''\n\t\t\tif(this.type == 0){\n\t\t\t\turl = '/index/updatemsg';\n\t\t\t} else {\n\t\t\t\turl = '/index/updategroupmsg'\n\t\t\t}\n\t\t\tconst data = {\n\t\t\t\tuid: this.uid,\n\t\t\t\tfid: this.fid,\n\t\t\t\ttoken: this.token\n\t\t\t};\n\t\t\tthis.request(url, data);\n\t\t// }\n\t},\n\tdata() {\n\t\treturn {\n\t\t\tuid: '',\n\t\t\timgurl: '',\n\t\t\ttoken: '',\n\t\t\tmyname: '',\n\t\t\tfid: '',\n\t\t\tfname: '', //好友的名字\n\t\t\tfimgurl: '', //好友头像地址\n\t\t\ttype: '', //0是私聊，1是群聊\n\t\t\tmsgs: [], //聊天信息数组\n\t\t\timgs: [], //图片数组\n\t\t\tscrollToView: '', //某子元素id（id不能以数字开头）。设置哪个方向可滚动，则在哪个方向滚动到该元素\n\t\t\tsendHeight: 0, //输入栏的高度，聊天页面距离底部的距离\n\t\t\tnowPage: 0,\n\t\t\tpageSize: 13,\n\t\t\tisLoading: false\n\t\t};\n\t},\n\tmethods: {\n\t\t//获取缓存数据\n\t\tgetStorages() {\n\t\t\ttry {\n\t\t\t\tconst value = uni.getStorageSync('user');\n\t\t\t\tif (value) {\n\t\t\t\t\tthis.uid = value.id;\n\t\t\t\t\tthis.imgurl = this.serverUrl + value.imgurl;\n\t\t\t\t\tthis.token = value.token;\n\t\t\t\t\tthis.myname = value.name;\n\t\t\t\t} else {\n\t\t\t\t\t//如果没有用户缓存，跳转到登录页面\n\t\t\t\t\tuni.redirectTo({\n\t\t\t\t\t\turl: '../login/login'\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\t// error\n\t\t\t}\n\t\t},\n\n\t\tback() {\n\t\t\tlet routes = getCurrentPages();\n\t\t\troutes.length == 1 ?\n\t\t\tuni.navigateTo({\n\t\t\t\turl:'../index/index'\n\t\t\t}) :\n\t\t\tuni.navigateBack();\n\t\t},\n\n\t\t//获取聊天数据\n\t\tgetMsg() {\n\t\t\tvar url = '';\n\t\t\tvar data = {}\n\t\t\tif (this.type == 0) {\n\t\t\t\t//是私聊\n\t\t\t\turl = '/chat/msg';\n\t\t\t\tdata = {\n\t\t\t\t\tuid: this.uid,\n\t\t\t\t\tfid: this.fid,\n\t\t\t\t\tnowPage: this.nowPage,\n\t\t\t\t\tpageSize: this.pageSize,\n\t\t\t\t\ttoken: this.token\n\t\t\t\t};\n\t\t\t} else if (this.type == 1) {\n\t\t\t\t// 是群聊\n\t\t\t\turl = '/chat/groupMsg';\n\t\t\t\tdata = {\n\t\t\t\t\tgid: this.fid,\n\t\t\t\t\tnowPage: this.nowPage,\n\t\t\t\t\tpageSize: this.pageSize,\n\t\t\t\t\ttoken: this.token\n\t\t\t\t};\n\t\t\t}\n\t\t\tconsole.log(url);\n\t\t\tthis.request(url, data).then(res => {\n\t\t\t\tif (res.length > 0) {\n\t\t\t\t\tfor (var i in res) {\n\t\t\t\t\t\tres[i].imgurl = this.serverUrl + res[i].imgurl;\n\t\t\t\t\t\t//图片处理\n\t\t\t\t\t\tif (res[i].type == 1) {\n\t\t\t\t\t\t\tres[i].message = this.serverUrl + res[i].message;\n\t\t\t\t\t\t\tthis.imgs.unshift(res[i].message);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t//定位，语音处理\n\t\t\t\t\t\tif (res[i].type == 2 || res[i].type == 3) {\n\t\t\t\t\t\t\tres[i].message = JSON.parse(res[i].message);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.msgs.unshift(res[i]);\n\t\t\t\t\t}\n\t\t\t\t\t//时间间隔处理,超过五分钟显示时间\n\t\t\t\t\tlet time = 0;\n\t\t\t\t\tfor (let item of this.msgs) {\n\t\t\t\t\t\tif (new Date(item.time).getTime() > time + 1000 * 60 * 5) {\n\t\t\t\t\t\t\ttime = new Date(item.time).getTime();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\titem.time = '';\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (this.nowPage == 0) {\n\t\t\t\t\t\tthis.$nextTick(() => {\n\t\t\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t\t\tthis.scrollToView = 'msg' + this.msgs[i].id;\n\t\t\t\t\t\t\t}, 300);\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.$nextTick(() => {\n\t\t\t\t\t\t\tthis.scrollToView = 'msg' + res[0].id;\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t//判断nowPage\n\t\t\t\tif (res.length == this.pageSize) {\n\t\t\t\t\tthis.nowPage++;\n\t\t\t\t} else {\n\t\t\t\t\tthis.nowPage = -1;\n\t\t\t\t}\n\t\t\t\tif (this.isLoading) {\n\t\t\t\t\tuni.stopPullDownRefresh();\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\t// 滑动到顶部时\n\t\tscrolltoupper() {\n\t\t\tif (this.nowPage != -1) {\n\t\t\t\tuni.startPullDownRefresh({\n\t\t\t\t\tsuccess: () => {\n\t\t\t\t\t\tthis.isLoading = true;\n\t\t\t\t\t\tthis.getMsg();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\n\t\t//获取子组件输入框传来的值,发送给后端并插入数组中\n\t\tsendMsg(e) {\n\t\t\tconsole.log(e.message.length);\n\t\t\tthis.sendBack(e);\n\t\t\tthis.receiveMsg(e, this.uid, this.imgurl, 0);\n\t\t},\n\n\t\t//输入框的东西发送给后端\n\t\tsendBack(e) {\n\t\t\t//文字,定位发送给后端\n\t\t\tif (e.type == 0 || e.type == 3) {\n\t\t\t\tthis.sendSocket(e);\n\t\t\t}\n\t\t\t// 图片发送给后端\n\t\t\tif (e.type == 1) {\n\t\t\t\t//图片存进显示的数组\n\t\t\t\tthis.imgs.push(e.message);\n\t\t\t\t// 后端存储文件夹名称为年月日\n\t\t\t\tlet url = this.fileName(new Date());\n\t\t\t\tuni.uploadFile({\n\t\t\t\t\turl: this.serverUrl + '/files/upload',\n\t\t\t\t\tfilePath: e.message,\n\t\t\t\t\tname: 'file',\n\t\t\t\t\tformData: {\n\t\t\t\t\t\turl: url,\n\t\t\t\t\t\tname: new Date().getTime() + this.uid + Math.floor(Math.random() * 10 + 1)\n\t\t\t\t\t},\n\t\t\t\t\tsuccess: uploadFileRes => {\n\t\t\t\t\t\tlet data = {\n\t\t\t\t\t\t\tmessage: uploadFileRes.data,\n\t\t\t\t\t\t\ttype: 1\n\t\t\t\t\t\t};\n\t\t\t\t\t\tthis.sendSocket(data);\n\t\t\t\t\t},\n\t\t\t\t\tfail: Error => {\n\t\t\t\t\t\tconsole.log(Error);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t//语音发给后端\n\t\t\tif (e.type == 2) {\n\t\t\t\tconsole.log(e);\n\t\t\t\t// url是存储文件夹名称为年月日\n\t\t\t\tlet url = this.fileName(new Date());\n\t\t\t\tuni.uploadFile({\n\t\t\t\t\turl: this.serverUrl + '/files/upload',\n\t\t\t\t\tfilePath: e.message.record,\n\t\t\t\t\tname: 'file',\n\t\t\t\t\tformData: {\n\t\t\t\t\t\turl: url,\n\t\t\t\t\t\tname: new Date().getTime() + this.uid\n\t\t\t\t\t},\n\t\t\t\t\tsuccess: uploadFileRes => {\n\t\t\t\t\t\tlet recordMsg = {\n\t\t\t\t\t\t\trecord: uploadFileRes.data,\n\t\t\t\t\t\t\ttime: e.message.time\n\t\t\t\t\t\t};\n\t\t\t\t\t\trecordMsg = JSON.stringify(recordMsg);\n\t\t\t\t\t\tlet data = {\n\t\t\t\t\t\t\tmessage: recordMsg,\n\t\t\t\t\t\t\ttype: e.type\n\t\t\t\t\t\t};\n\t\t\t\t\t\tthis.sendSocket(data);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\n\t\t//语音文件夹上传时间\n\t\tfileName(e) {\n\t\t\tlet old = new Date(e);\n\n\t\t\t//获取oldDate的具体时间\n\t\t\tlet hour = old.getHours();\n\t\t\tlet minute = old.getMinutes();\n\t\t\tlet year = old.getFullYear();\n\t\t\tlet month = (old.getMonth() + 1).toString().padStart(2, 0); //获取的比实际要小，所以要加一\n\t\t\tlet day = old\n\t\t\t\t.getDate()\n\t\t\t\t.toString()\n\t\t\t\t.padStart(2, 0);\n\t\t\treturn year + month + day;\n\t\t},\n\n\t\t//接收输入框的信息显示\n\t\treceiveMsg(e, id, imgurl, tip) {\n\t\t\t//tip=0表示自己发的，tip=1表示收到的\n\t\t\t//显示到主页面\n\t\t\tif (e.type == 3) {\n\t\t\t\te.message = JSON.parse(e.message);\n\t\t\t}\n\t\t\tlet leng = this.msgs.length;\n\t\t\tlet data = {\n\t\t\t\tfromID: id,\n\t\t\t\timgurl: imgurl,\n\t\t\t\tmessage: e.message,\n\t\t\t\ttype: e.type,\n\t\t\t\ttime: new Date(),\n\t\t\t\tid: leng\n\t\t\t};\n\t\t\t//时间间隔显示处理\n\t\t\tif (this.msgs.length > 0) {\n\t\t\t\tfor (var i = 1; i < leng; i++) {\n\t\t\t\t\tif (this.msgs[leng - i].time) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tlet time = this.msgs[leng - i].time;\n\t\t\t\tif (data.time > time + 1000 * 60 * 5) {\n\t\t\t\t\ttime = data.time;\n\t\t\t\t} else {\n\t\t\t\t\tdata.time = '';\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.msgs.push(data);\n\t\t},\n\n\t\t//接收私聊socket发来的数据\n\t\tscoketMsg() {\n\t\t\tthis.socket.on('msg', (msg, uid, tip) => {\n\t\t\t\tif (uid == this.fid && tip == 0) {\n\t\t\t\t\tlet leng = this.msgs.length;\n\t\t\t\t\tif (msg.type == 1) {\n\t\t\t\t\t\tmsg.message = this.serverUrl + msg.message;\n\t\t\t\t\t} else if (msg.type == 2) {\n\t\t\t\t\t\tmsg.message = JSON.parse(msg.message);\n\t\t\t\t\t\tconsole.log(msg.message);\n\t\t\t\t\t\tmsg.message.record = this.serverUrl + msg.message.record;\n\t\t\t\t\t} else if (msg.type == 3) {\n\t\t\t\t\t\tmsg.message = JSON.parse(msg.message);\n\t\t\t\t\t}\n\n\t\t\t\t\tlet data = {\n\t\t\t\t\t\tfromID: uid,\n\t\t\t\t\t\timgurl: this.fimgurl,\n\t\t\t\t\t\tmessage: msg.message,\n\t\t\t\t\t\ttype: msg.type,\n\t\t\t\t\t\ttime: new Date(),\n\t\t\t\t\t\tid: leng\n\t\t\t\t\t};\n\t\t\t\t\t//时间间隔显示处理\n\t\t\t\t\tfor (var i = 1; i < leng; i++) {\n\t\t\t\t\t\tif (this.msgs[leng - i].time) {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tlet time = this.msgs[leng - i].time;\n\t\t\t\t\tif (data.time > time + 1000 * 60 * 5) {\n\t\t\t\t\t\ttime = data.time;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdata.time = '';\n\t\t\t\t\t}\n\t\t\t\t\t//图片存进显示的数组\n\t\t\t\t\tif (msg.type == 1) {\n\t\t\t\t\t\tthis.imgs.push(msg.message);\n\t\t\t\t\t\tconsole.log(this.imgs);\n\t\t\t\t\t}\n\t\t\t\t\tthis.msgs.push(data);\n\t\t\t\t\tthis.$nextTick(function() {\n\t\t\t\t\t\tthis.scrollToView = 'msg' + this.msgs[leng].id;\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\t\n\t\t//接受群的socket信息\n\t\tscoketGroupMsg() {\n\t\t\tthis.socket.on('groupMsg', (msg, fromid, gid, fromName, fromImg) => {\n\t\t\t\t\tlet leng = this.msgs.length;\n\t\t\t\t\tif (msg.type == 1) {\n\t\t\t\t\t\tmsg.message = this.serverUrl + msg.message;\n\t\t\t\t\t} else if (msg.type == 2) {\n\t\t\t\t\t\tmsg.message = JSON.parse(msg.message);\n\t\t\t\t\t\tmsg.message.record = this.serverUrl + msg.message.record;\n\t\t\t\t\t} else if (msg.type == 3) {\n\t\t\t\t\t\t//#ifdef H5\n\t\t\t\t\t\tmsg.message = JSON.parse(msg.message);\n\t\t\t\t\t\t//#endif\n\t\t\t\t\t}\n\t\t\n\t\t\t\t\tlet data = {\n\t\t\t\t\t\tfromID: fromid,\n\t\t\t\t\t\timgurl: fromImg,\n\t\t\t\t\t\tmessage: msg.message,\n\t\t\t\t\t\ttype: msg.type,\n\t\t\t\t\t\ttime: new Date(),\n\t\t\t\t\t\tid: leng\n\t\t\t\t\t};\n\t\t\t\t\t//时间间隔显示处理\n\t\t\t\t\tfor (var i = 1; i < leng; i++) {\n\t\t\t\t\t\tif (this.msgs[leng - i].time) {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tlet time = this.msgs[leng - i].time;\n\t\t\t\t\tif (data.time > time + 1000 * 60 * 5) {\n\t\t\t\t\t\ttime = data.time;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdata.time = '';\n\t\t\t\t\t}\n\t\t\t\t\t//图片存进显示的数组\n\t\t\t\t\tif (msg.type == 1) {\n\t\t\t\t\t\tthis.imgs.push(msg.message);\n\t\t\t\t\t\tconsole.log(this.imgs);\n\t\t\t\t\t}\n\t\t\t\t\tthis.msgs.push(data);\n\t\t\t\t\tthis.$nextTick(function() {\n\t\t\t\t\t\tthis.scrollToView = 'msg' + this.msgs[leng].id;\n\t\t\t\t\t});\n\t\t\t});\n\t\t},\n\n\t\t//聊天数据发送到后端\n\t\tsendSocket(e) {\n\t\t\tif (this.type == 0) {\n\t\t\t\t//私聊\n\t\t\t\tthis.socket.emit('msg', e, this.uid, this.fid);\n\t\t\t} else {\n\t\t\t\t//群聊\n\t\t\t\tthis.socket.emit('groupMsg', e, this.uid, this.fid, this.myname, this.imgurl);\n\t\t\t}\n\t\t},\n\n\t\t//输入框弹起的高度,传过来的是弹出的高度值\n\t\theights(e) {\n\t\t\t//如果消息数组大于10才更新高度\n\t\t\tif (this.msgs.length > 6) {\n\t\t\t\tthis.sendHeight = e;\n\t\t\t}\n\t\t\tthis.scrollToView = '';\n\t\t\tthis.$nextTick(function() {\n\t\t\t\tlet leng = this.msgs.length - 1;\n\t\t\t\tthis.scrollToView = 'msg' + this.msgs[leng].id;\n\t\t\t});\n\t\t},\n\n\t\t//获取设备的高度\n\t\tgetElementStyle() {\n\t\t\tconst query = uni.createSelectorQuery().in(this);\n\t\t\tquery\n\t\t\t\t.select('.send')\n\t\t\t\t.boundingClientRect(data => {\n\t\t\t\t\tconsole.log(data);\n\t\t\t\t\tthis.sendHeight = data.height;\n\t\t\t\t})\n\t\t\t\t.exec();\n\t\t},\n\n\t\t//跳转到群聊管理页面\n\t\tgoGroupHome() {\n\t\t\tthis.$refs.send.cancel()\n\t\t\t// setTimeout(() => {\n\t\t\t// \tthis.getElementStyle()\n\t\t\t// },300)\n\t\t\tuni.navigateTo({\n\t\t\t\turl: '../groupHome/groupHome?gid=' + this.fid\n\t\t\t});\n\t\t},\n\t\t\n\t\tgoUserHome(fid){\n\t\t\tthis.$refs.send.cancel()\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.getElementStyle()\n\t\t\t},300)\n\t\t\tuni.navigateTo({\n\t\t\t\turl:'../userHome/userHome?id='+fid\n\t\t\t});\n\t\t}\n\n\t}\n};\n</script>\n\n<style lang=\"scss\">\npage {\n\theight: 100%;\n}\n.wrapper {\n\theight: 100%;\n\tbackground-color: rgba(244, 244, 244, 1);\n}\n.top-bar {\n\tpadding-top: var(--status-bar-height);\n\tbackground-color: rgba(244, 244, 244, 1);\n\tborder-bottom: 1px solid $uni-border-color; //底部分割线\n\t.back {\n\t\tfloat: left;\n\t\tpadding: 20rpx 0;\n\t\twidth: 48rpx;\n\t\theight: 48rpx;\n\t}\n\t.title {\n\t\tcolor: $uni-text-color;\n\t\tfont-size: 40rpx;\n\t\tpadding: 16rpx 0 16rpx 32rpx;\n\t\ttext-align: left;\n\t}\n\t.more {\n\t\twidth: 68rpx;\n\t\theight: 68rpx;\n\t\tborder-radius: $uni-border-radius-sm;\n\t}\n}\n.chat-wrapper {\n\twidth: 100%;\n\theight: 100%;\n\tbackground-color: rgba(244, 244, 244, 1);\n\tpadding: 108rpx $uni-spacing-row-base 0;\n\t// #ifdef APP-PLUS\n\tpadding-top: 158rpx;\n\t// #endif\n\tbox-sizing: border-box;\n}\n</style>\n","import mod from \"-!D:\\\\App\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\mini-css-extract-plugin\\\\dist\\\\loader.js??ref--8-oneOf-1-0!D:\\\\App\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\css-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-1!D:\\\\App\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\stylePostLoader.js!D:\\\\App\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-2!D:\\\\App\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\postcss-loader\\\\src\\\\index.js??ref--8-oneOf-1-3!D:\\\\App\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\sass-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-4!D:\\\\App\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-5!D:\\\\App\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\App\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./chatRoom.vue?vue&type=style&index=0&lang=scss&\"; export default mod; export * from \"-!D:\\\\App\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\mini-css-extract-plugin\\\\dist\\\\loader.js??ref--8-oneOf-1-0!D:\\\\App\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\css-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-1!D:\\\\App\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\stylePostLoader.js!D:\\\\App\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-2!D:\\\\App\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\postcss-loader\\\\src\\\\index.js??ref--8-oneOf-1-3!D:\\\\App\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\sass-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-4!D:\\\\App\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-5!D:\\\\App\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\App\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./chatRoom.vue?vue&type=style&index=0&lang=scss&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1615995599328\n      var cssReload = require(\"D:/App/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"../../\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}